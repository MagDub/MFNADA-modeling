
clear;

data_for_figs_f = '../../data/data_for_figs/';

%% Data behaviour

load(strcat(data_for_figs_f, '/mat_LH_apple_picked_all.mat'));
load(strcat(data_for_figs_f, '/mat_LH_apple_picked_all_desc.mat'));


%%
n=60;

% split in 2 matrices (2 conditions) and average within participants
mean_exploited = nan(n,6);
mean_explored = nan(n,6);

for part=1:n
    
    if part~=6
        
        tmp = mat_LH_apple_picked_all{part};

        first_is_high = tmp(tmp(:,6)==1,6:11);
        first_is_novel = tmp(tmp(:,6)==3,6:11);
        first_is_low = tmp(tmp(:,6)==4,6:11);
        first_is_medium = tmp(tmp(:,6)==0,6:11);
        first_is_nothigh = tmp(tmp(:,6)~=1,6:11);
        
        p_high_after_high = size(find(first_is_high(:,2)==1),1) / size(first_is_high,1);
        p_nothigh_after_high = size(find(first_is_high(:,2)~=1),1) / size(first_is_high,1);
        p_novel_after_high = size(find(first_is_high(:,2)==3),1) / size(first_is_high,1);
        p_low_after_high = size(find(first_is_high(:,2)==4),1) / size(first_is_high,1);
        
        p_high_after_low = size(find(first_is_low(:,2)==1),1) / size(first_is_low,1);
        p_nothigh_after_low = size(find(first_is_low(:,2)~=1),1) / size(first_is_low,1);
        p_novel_after_low = size(find(first_is_low(:,2)==3),1) / size(first_is_low,1);
        p_low_after_low = size(find(first_is_low(:,2)==4),1) / size(first_is_low,1);
        
        p_high_after_novel = size(find(first_is_novel(:,2)==1),1) / size(first_is_novel,1);
        p_nothigh_after_novel = size(find(first_is_novel(:,2)~=1),1) / size(first_is_novel,1);
        p_novel_after_novel = size(find(first_is_novel(:,2)==3),1) / size(first_is_novel,1);
        p_low_after_novel = size(find(first_is_novel(:,2)==4),1) / size(first_is_novel,1);
        
        p_high_after_medium = size(find(first_is_medium(:,2)==1),1) / size(first_is_medium,1);
        p_nothigh_after_medium = size(find(first_is_medium(:,2)~=1),1) / size(first_is_medium,1);
        p_novel_after_medium = size(find(first_is_medium(:,2)==3),1) / size(first_is_medium,1);
        p_low_after_medium = size(find(first_is_medium(:,2)==4),1) / size(first_is_medium,1);
        
        first_is_low_ = first_is_low(:,2:end);
        first_is_high_ = first_is_high(:,2:end);
        first_is_novel_ = first_is_novel(:,2:end);
        first_is_medium_ = first_is_medium(:,2:end);
                
        count_low  = histc(first_is_low_(:),[0, 1, 3, 4]);
        freq_low(part, :) = count_low./sum(count_low)';
        
        count_high  = histc(first_is_high_(:),[0, 1, 3, 4]);
        freq_high(part, :) = count_high./sum(count_high)';
        
        count_novel  = histc(first_is_novel_(:),[0, 1, 3, 4]);
        freq_novel(part, :) = count_novel./sum(count_novel)';
        
        count_medium  = histc(first_is_medium_(:),[0, 1, 3, 4]);
        freq_medium(part, :) = count_medium./sum(count_medium)';
        
        p_same(part, :) = [p_high_after_high, p_low_after_low, p_novel_after_novel];
 
    end
    
end

figure()

subplot(2,2,1)
bar([1,2,3,4], mean(freq_low,1))
title('Draw after low-value')
xticklabels({'medium', 'high', 'novel', 'low'})
ylim([0,1])

subplot(2,2,2)
bar([1,2,3,4], mean(freq_high,1))
title('Draw after high-value')
xticklabels({'medium', 'high', 'novel', 'low'})
ylim([0,1])

subplot(2,2,3)
bar([1,2,3,4], mean(freq_novel,1))
title('Draw after novel-value')
xticklabels({'medium', 'high', 'novel', 'low'})
ylim([0,1])

subplot(2,2,4)
bar([1,2,3,4], mean(freq_medium,1))
title('Draw after medium-value')
xticklabels({'medium', 'high', 'novel', 'low'})
ylim([0,1])

% figure()
% bar([1,2,3], mean(p_same,1))
% title('Probability of picking same bandit on 2nd trial')
% xticklabels({'High-value', 'Low-value', 'Novel'})
% 
% for part=1:n
%     
%     if part~=6
%         
%         tmp = mat_LH_apple_picked_all{part};
%         draws = tmp(:,6:11);
%         
%     end
% end
% 
% draws(:,1:2)
% 

% do probabiliry of same choice when starting with D
% do probabiliry of same choice when starting with C
% do probabiliry of same choice when starting with high

% % split in 2 matrices (2 conditions) and average within participants
% mean_exploited = nan(n,6);
% mean_explored = nan(n,6);
% 
% for part=1:n
%     
%     if part~=6
%         tmp = score_mat_all_apples{part};
% 
%         score_exploited = tmp(tmp(:,2)==1,3:9);
%         score_explored = tmp(tmp(:,2)==0,3:9);
% 
%         cumulative_score_exploited = [score_exploited(:,1) ...
%                     score_exploited(:,2) ...
%                     score_exploited(:,3)...
%                     score_exploited(:,4) ...
%                     score_exploited(:,5) ...
%                     score_exploited(:,6)];
% 
%         diff_score_exploited = cumulative_score_exploited - score_exploited(:,7);
% 
%         cumulative_score_explored = [score_explored(:,1) ...
%                     score_explored(:,2) ...
%                     score_explored(:,3)...
%                     score_explored(:,4) ...
%                     score_explored(:,5) ...
%                     score_explored(:,6)];
% 
%         diff_score_explored = cumulative_score_explored - score_explored(:,7);
% 
%         mean_exploited(part,:) = mean(diff_score_exploited,1);
%         mean_explored(part,:) = mean(diff_score_explored,1);
%     end
% end
% 
% %% Figure
% 
% figure('Color','w');
% set(gcf,'Unit','centimeters','OuterPosition',[0 0 10 10]);
% set(gca,'FontName','Arial','FontSize',10)
% hold on
% 
% col(1,:) = [0.39215686917305 0.474509805440903 0.635294139385223];
% 
% plot([1:6],nanmean(mean_exploited,1),'LineWidth',4, 'Color',[col(1,:) 0.5]); hold on;
% plot([1:6],nanmean(mean_explored,1),'LineWidth',4, 'Color',[col(1,:) 1]); hold on;
% plot([1:6],nanmean(mean_exploited,1)-nanstd(mean_exploited,1)./sqrt(n),'LineWidth',1, 'Color',[col(1,:) 0.5]); hold on;
% plot([1:6],nanmean(mean_exploited,1)+nanstd(mean_exploited,1)./sqrt(n),'LineWidth',1, 'Color',[col(1,:) 0.5]); hold on;
% plot([1:6],nanmean(mean_explored,1)-nanstd(mean_explored,1)./sqrt(n),'LineWidth',1, 'Color',[col(1,:) 1]); hold on;
% plot([1:6],nanmean(mean_explored,1)+nanstd(mean_explored,1)./sqrt(n),'LineWidth',1, 'Color',[col(1,:) 1]); hold on;
% plot([1:6], zeros(1,6),'--k', 'LineWidth',1)
% 
% legend({'starts with exploitation', 'starts with exploration'},'Position',[0.448792517564846 0.496626992216187 0.469613249871612 0.126190476190476]);
% %title('Reward in the long horizon')
% 
% %ylim([-0.63 0.63])
% set(gca,'YTick',-0.6:0.3:0.6)
% set(gca,'XTick',1:1:6)
% ylabel('Increase in reward')
% xlabel('trial')

%% Export

addpath('../../export_fig/')
export_fig(['Fig_behaviour_LH_2nd_trial.tif'],'-nocrop','-r200')




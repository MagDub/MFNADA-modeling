
close all;

[chosenOptionFreqABD,chosenOptionFreqABD_desc,exploitMatABD_LH, exploitMatABD_LH_desc, FreqisExploited_ABD, FreqisExplored_ABD, exploitTreeisA_ABD, exploitTreeisB_ABD]=make_exploit_option_ABD();
[chosenOptionFreqAB,chosenOptionFreqAB_desc,exploitMatAB_LH, exploitMatAB_LH_desc, FreqisExploited_AB, FreqisExplored_AB, exploitTreeisA_AB, exploitTreeisB_AB]=make_exploit_option_AB();
[chosenOptionFreqBD,chosenOptionFreqBD_desc,exploitMatBD_LH, exploitMatBD_LH_desc, FreqisExploited_BD, FreqisExplored_BD]=make_exploit_option_BD();
[chosenOptionFreqAD,chosenOptionFreqAD_desc,exploitMatAD_LH, exploitMatAD_LH_desc, FreqisExploited_AD, FreqisExplored_AD]=make_exploit_option_AD();

for part = 1:60
    if round(chosenOptionFreqAD(part,1)*50) ~= (FreqisExploited_AD{part}.TreeA_SH+FreqisExploited_AD{part}.TreeB_SH)
        disp(strcat('something wrong with part',int2str(part)))
    end
end

chosenOption.ABD.desc = chosenOptionFreqABD_desc;
chosenOption.ABD.freq = chosenOptionFreqABD;
chosenOption.AB.desc = chosenOptionFreqAB_desc;
chosenOption.AB.freq = chosenOptionFreqAB;
chosenOption.BD.desc = chosenOptionFreqBD_desc;
chosenOption.BD.freq = chosenOptionFreqBD;
chosenOption.AD.desc = chosenOptionFreqAD_desc;
chosenOption.AD.freq = chosenOptionFreqAD;

for part=1:60
    FreqisExploited_TreeA_LH(part) = FreqisExploited_ABD{part}.TreeA_LH + FreqisExploited_AB{part}.TreeA_LH + FreqisExploited_BD{part}.TreeA_LH + FreqisExploited_AD{part}.TreeA_LH;
    FreqisExploited_TreeA_SH(part) = FreqisExploited_ABD{part}.TreeA_SH + FreqisExploited_AB{part}.TreeA_SH + FreqisExploited_BD{part}.TreeA_SH + FreqisExploited_AD{part}.TreeA_SH;
    FreqisExploited_TreeB_LH(part) = FreqisExploited_ABD{part}.TreeB_LH + FreqisExploited_AB{part}.TreeB_LH+ FreqisExploited_BD{part}.TreeB_LH + FreqisExploited_AD{part}.TreeB_LH;
    FreqisExploited_TreeB_SH(part) = FreqisExploited_ABD{part}.TreeB_SH + FreqisExploited_AB{part}.TreeB_SH + FreqisExploited_BD{part}.TreeB_SH + FreqisExploited_AD{part}.TreeB_SH;
end

for part=1:60
    FreqisExplored_TreeA_LH(part) = FreqisExplored_ABD{part}.TreeA_LH + FreqisExplored_AB{part}.TreeA_LH + FreqisExplored_BD{part}.TreeA_LH + FreqisExplored_AD{part}.TreeA_LH;
    FreqisExplored_TreeA_SH(part) = FreqisExplored_ABD{part}.TreeA_SH + FreqisExplored_AB{part}.TreeA_SH + FreqisExplored_BD{part}.TreeA_SH + FreqisExplored_AD{part}.TreeA_SH;
    FreqisExplored_TreeB_LH(part) = FreqisExplored_ABD{part}.TreeB_LH + FreqisExplored_AB{part}.TreeB_LH+ FreqisExplored_BD{part}.TreeB_LH + FreqisExplored_AD{part}.TreeB_LH;
    FreqisExplored_TreeB_SH(part) = FreqisExplored_ABD{part}.TreeB_SH + FreqisExplored_AB{part}.TreeB_SH + FreqisExplored_BD{part}.TreeB_SH + FreqisExplored_AD{part}.TreeB_SH;
end

for part=1:60
    FreqisExploited_TreeA_LH_ACD_BCD(part) = FreqisExploited_BD{part}.TreeA_LH + FreqisExploited_AD{part}.TreeA_LH;
    FreqisExploited_TreeA_SH_ACD_BCD(part) = FreqisExploited_BD{part}.TreeA_SH + FreqisExploited_AD{part}.TreeA_SH;
    FreqisExploited_TreeB_LH_ACD_BCD(part) = FreqisExploited_BD{part}.TreeB_LH + FreqisExploited_AD{part}.TreeB_LH;
    FreqisExploited_TreeB_SH_ACD_BCD(part) = FreqisExploited_BD{part}.TreeB_SH + FreqisExploited_AD{part}.TreeB_SH;
end

for part=1:60
    FreqisExplored_TreeA_LH_ACD_BCD(part) = FreqisExplored_BD{part}.TreeA_LH + FreqisExplored_AD{part}.TreeA_LH;
    FreqisExplored_TreeA_SH_ACD_BCD(part) = FreqisExplored_BD{part}.TreeA_SH + FreqisExplored_AD{part}.TreeA_SH;
    FreqisExplored_TreeB_LH_ACD_BCD(part) = FreqisExplored_BD{part}.TreeB_LH + FreqisExplored_AD{part}.TreeB_LH;
    FreqisExplored_TreeB_SH_ACD_BCD(part) = FreqisExplored_BD{part}.TreeB_SH + FreqisExplored_AD{part}.TreeB_SH;
end

exploitTreeisA = (exploitTreeisA_ABD + exploitTreeisA_AB)';
exploitTreeisB = (exploitTreeisB_ABD + exploitTreeisB_AB)';


FreqisExploited_desc = {'A_LH', 'A_SH', 'B_LH', 'B_SH'};
FreqisExplored_desc = {'A_LH', 'A_SH', 'B_LH', 'B_SH'};

FreqisExploited = [FreqisExploited_TreeA_LH', FreqisExploited_TreeA_SH', FreqisExploited_TreeB_LH', FreqisExploited_TreeB_SH'];
FreqisExplored = [FreqisExplored_TreeA_LH', FreqisExplored_TreeA_SH', FreqisExplored_TreeB_LH', FreqisExplored_TreeB_SH'];

FreqisExploited_ACD_BCD = [FreqisExploited_TreeA_LH_ACD_BCD', FreqisExploited_TreeA_SH_ACD_BCD', FreqisExploited_TreeB_LH_ACD_BCD', FreqisExploited_TreeB_SH_ACD_BCD'];
FreqisExplored_ACD_BCD = [FreqisExplored_TreeA_LH_ACD_BCD', FreqisExplored_TreeA_SH_ACD_BCD', FreqisExplored_TreeB_LH_ACD_BCD', FreqisExplored_TreeB_SH_ACD_BCD'];

save('D:\writing\MF\data_for_figs\chosenOption.mat', 'chosenOption')
save('D:\writing\MF\data_for_figs\FreqisExploited.mat', 'FreqisExploited')
save('D:\writing\MF\data_for_figs\FreqisExploited_ACD_BCD.mat', 'FreqisExploited_ACD_BCD')
save('D:\writing\MF\data_for_figs\FreqisExploited_desc.mat', 'FreqisExploited_desc')
save('D:\writing\MF\data_for_figs\FreqisExplored.mat', 'FreqisExplored')
save('D:\writing\MF\data_for_figs\FreqisExplored_desc.mat', 'FreqisExplored_desc')

for part=1:60
    tmpABD=exploitMatABD_LH{part};
    tmpAB=exploitMatAB_LH{part};
    tmpBD=exploitMatBD_LH{part};
    tmpAD=exploitMatAD_LH{part};
    tmp_exploited=[tmpABD(:,1)==tmpABD(:,2),tmpABD(:,3),tmpABD(:,4),tmpABD(:,5),tmpABD(:,6),tmpABD(:,7);...
                    tmpAB(:,1)==tmpAB(:,2),tmpAB(:,3),tmpAB(:,4),tmpAB(:,5),tmpAB(:,6), tmpAB(:,7);...
                    tmpBD(:,1)==tmpBD(:,2),tmpBD(:,3),tmpBD(:,4),tmpBD(:,5),tmpBD(:,6), tmpBD(:,7);...
                    tmpAD(:,1)==tmpAD(:,2),tmpAD(:,3),tmpAD(:,4),tmpAD(:,5),tmpAD(:,6), tmpAD(:,7)];
    exploited{part}=tmp_exploited;
    mean_per_part(part,:)= [mean(tmp_exploited(tmp_exploited(:,1)==1,3)) mean(tmp_exploited(tmp_exploited(:,1)==0,3))];
end

exploited_desc = {'Exploited','GameID','SizePicked','Block','BlockTrial','SizeExploitationOption'}; 
mean_per_part_desc={'mean_when_exploited','mean_when_explored'};

[apple_sizes_LH, apple_sizes_LH_desc] = make_explore_exploit_averages(); %problem, apple_sizes for participant > 1 does not have 100 unique trialID

score_mat_all_apples = {};

for part=1:60
    
    tmp = exploited{part};
    tmp_app = apple_sizes_LH{part};

    mat_exploit(:,1) = tmp(:,4)*1000+tmp(:,5); %BlocktrialID
    mat_exploit(:,2) = tmp(:,1); %exploited
    mat_exploit(:,3) = tmp(:,3); %size picked
    mat_exploit(:,4) = tmp(:,6); %size of exploitation option
    if size(unique(mat_exploit(:,1)),1)~=200
        disp('problem, should be 200 trials')
    end
    
    mat_exploit_app(:,1) = tmp_app(:,1)*1000+tmp_app(:,2); %BlocktrialID
    mat_exploit_app(:,2:7) = tmp_app(:,4:9); % all apples picked
    if size(unique(mat_exploit_app(:,1)),1)~=200
        disp('problem, should be 200 trials')
    end

    % Match the 2 BlockTrialIDs
    sorted_mat_exploit=sortrows(mat_exploit,1); % should be 200
    sorted_mat_exploit_app=sortrows(mat_exploit_app,1); % should be 200

    if unique(sorted_mat_exploit(:,1)==sorted_mat_exploit_app(:,1))==1 && unique(sorted_mat_exploit(:,3)==sorted_mat_exploit_app(:,2))==1
        score_mat_all_apples{part} = [sorted_mat_exploit(:,1:2) sorted_mat_exploit_app(:,2:7) sorted_mat_exploit(:,4)];
    else
        disp('gameIDs or size of 1st app dont match')
    end
end

score_mat_all_apples_desc = {'BlocktrialID','isExploited','Apple1Size','Apple2Size','Apple3Size','Apple4Size','Apple5Size','Apple6Size', 'SizeExploitationOption'};


save('D:\writing\MF\data_for_figs\score_mat_all_apples.mat','score_mat_all_apples')
save('D:\writing\MF\data_for_figs\score_mat_all_apples_desc.mat','score_mat_all_apples_desc')



